<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EchoVice - AI Debate Bot</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Light mode colors */
      --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --bg-secondary: rgba(255, 255, 255, 0.1);
      --bg-chat: rgba(255, 255, 255, 0.15);
      --bg-message-user: rgba(103, 126, 234, 0.2);
      --bg-message-bot: rgba(118, 75, 162, 0.2);
      --text-primary: #ffffff;
      --text-secondary: #f8f9fa;
      --text-muted: rgba(255, 255, 255, 0.7);
      --border-color: rgba(255, 255, 255, 0.2);
      --shadow-color: rgba(0, 0, 0, 0.1);
      --accent-color: #667eea;
      --accent-hover: #5a6fd8;
    }

    [data-theme="dark"] {
      --bg-primary: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      --bg-secondary: rgba(255, 255, 255, 0.08);
      --bg-chat: rgba(40, 44, 52, 0.9);
      --bg-message-user: rgba(103, 126, 234, 0.15);
      --bg-message-bot: rgba(118, 75, 162, 0.15);
      --text-primary: #ffffff;
      --text-secondary: #e2e8f0;
      --text-muted: rgba(255, 255, 255, 0.6);
      --border-color: rgba(255, 255, 255, 0.1);
      --shadow-color: rgba(0, 0, 0, 0.3);
      --accent-color: #4f46e5;
      --accent-hover: #4338ca;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      color: var(--text-primary);
      transition: all 0.3s ease;
      overflow-x: hidden;
    }

    /* Background animation */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
      z-index: -1;
      animation: float 20s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-20px) rotate(1deg); }
      66% { transform: translateY(10px) rotate(-1deg); }
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    .title {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(45deg, #fff, #e2e8f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 1.1rem;
      font-weight: 300;
    }

    /* Theme toggle */
    .theme-toggle {
      position: absolute;
      top: 0;
      right: -60px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 50px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px var(--shadow-color);
    }

    .theme-toggle-icon {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .theme-toggle:hover .theme-toggle-icon {
      transform: rotate(180deg);
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      align-items: center;
    }

    .persona-container {
      position: relative;
    }

    .persona-label {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    #personaSelect {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--text-primary);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      min-width: 140px;
    }

    #personaSelect option {
      background: var(--bg-chat);
      color: var(--text-primary);
      padding: 8px;
      border: none;
    }

    /* Fix for WebKit browsers */
    #personaSelect option:checked {
      background: var(--accent-color);
      color: white;
    }

    #personaSelect:hover {
      border-color: var(--accent-color);
      box-shadow: 0 4px 15px rgba(103, 126, 234, 0.2);
    }

    #personaSelect:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(103, 126, 234, 0.1);
    }

    /* Chat container */
    .chat-container {
      width: 100%;
      max-width: 800px;
      background: var(--bg-chat);
      border: 1px solid var(--border-color);
      border-radius: 24px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      box-shadow: 0 20px 40px var(--shadow-color);
      overflow: hidden;
      margin-bottom: 1.5rem;
    }

    #chatbox {
      height: 500px;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      scroll-behavior: smooth;
    }

    /* Custom scrollbar */
    #chatbox::-webkit-scrollbar {
      width: 6px;
    }

    #chatbox::-webkit-scrollbar-track {
      background: transparent;
    }

    #chatbox::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 3px;
    }

    #chatbox::-webkit-scrollbar-thumb:hover {
      background: var(--accent-color);
    }

    /* Messages */
    .message {
      padding: 1rem 1.25rem;
      border-radius: 18px;
      max-width: 80%;
      word-wrap: break-word;
      line-height: 1.5;
      position: relative;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .user {
      background: var(--bg-message-user);
      align-self: flex-end;
      margin-left: auto;
    }

    .bot {
      background: var(--bg-message-bot);
      align-self: flex-start;
      position: relative;
    }

    .bot::before {
      content: '🤖';
      position: absolute;
      top: -8px;
      left: -8px;
      background: var(--accent-color);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      border: 2px solid var(--bg-chat);
    }

    /* Input area */
    .input-area {
      width: 100%;
      max-width: 800px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 24px;
      padding: 1rem;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      box-shadow: 0 10px 30px var(--shadow-color);
    }

    #inputBox {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    #statement {
      flex-grow: 1;
      background: transparent;
      border: none;
      padding: 12px 16px;
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 1rem;
      background: var(--bg-chat);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    #statement:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(103, 126, 234, 0.1);
    }

    #statement::placeholder {
      color: var(--text-muted);
    }

    #submitBtn {
      background: var(--accent-color);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    #submitBtn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(103, 126, 234, 0.3);
    }

    #submitBtn:active {
      transform: translateY(0);
    }

    #submitBtn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    #submitBtn:hover::before {
      left: 100%;
    }

    /* Typing animation */
    .typing {
      font-style: italic;
      color: var(--text-muted);
      background: var(--bg-message-bot);
      position: relative;
    }

    .typing::after {
      content: '';
      width: 20px;
      height: 4px;
      border-radius: 2px;
      background: var(--accent-color);
      animation: typing 1.4s infinite ease-in-out;
      display: inline-block;
      margin-left: 8px;
    }

    @keyframes typing {
      0%, 60%, 100% {
        transform: scaleX(1);
        opacity: 1;
      }
      30% {
        transform: scaleX(0.5);
        opacity: 0.5;
      }
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .title {
        font-size: 2rem;
      }
      
      .theme-toggle {
        position: static;
        margin-top: 1rem;
      }
      
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .chat-container {
        margin: 0 -10px;
        border-radius: 16px;
      }
      
      #chatbox {
        height: 400px;
        padding: 1rem;
      }
      
      .message {
        max-width: 90%;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .title {
        font-size: 1.8rem;
      }
      
      #inputBox {
        flex-direction: column;
      }
      
      #statement {
        margin-bottom: 0.5rem;
      }
      
      #submitBtn {
        width: 100%;
      }
    }
  </style>
</head>
<body data-theme="light">
  <div class="header">
    <h1 class="title">👾 EchoVice</h1>
    <p class="subtitle">AI Debate Bot - Challenge Every Perspective</p>
    <div class="theme-toggle" onclick="toggleTheme()">
      <span class="theme-toggle-icon">🌙</span>
    </div>
  </div>

  <div class="controls">
    <div class="persona-container">
      <label class="persona-label">Choose Debate Style:</label>
      <select id="personaSelect">
        <option value="default" selected>🧠 Default</option>
        <option value="serious">🎓 Serious Scholar</option>
        <option value="sarcastic">😏 Sarcastic Wit</option>
        <option value="casual">😎 Casual Friend</option>
      </select>
    </div>
  </div>

  <div class="chat-container">
    <div id="chatbox"></div>
  </div>

  <div class="input-area">
    <div id="inputBox">
      <input type="text" id="statement" placeholder="Share your perspective and I'll challenge it..." />
      <button id="submitBtn">
        <span>Debate</span>
      </button>
    </div>
  </div>

 <script>
  const chatbox = document.getElementById('chatbox');
  const statementInput = document.getElementById('statement');
  const submitBtn = document.getElementById('submitBtn');
  const personaSelect = document.getElementById('personaSelect');

  let sessionHistory = [];
  let isFetching = false;

  function toggleTheme() {
    const body = document.body;
    const themeToggle = document.querySelector('.theme-toggle-icon');
    const currentTheme = body.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';

    body.setAttribute('data-theme', newTheme);
    themeToggle.textContent = newTheme === 'light' ? '🌙' : '☀️';
    localStorage.setItem('theme', newTheme);
  }

  function loadTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    const body = document.body;
    const themeToggle = document.querySelector('.theme-toggle-icon');

    body.setAttribute('data-theme', savedTheme);
    themeToggle.textContent = savedTheme === 'light' ? '🌙' : '☀️';
  }

  function appendMessage(text, sender) {
    const message = document.createElement('div');
    message.classList.add('message', sender);
    message.textContent = text;
    chatbox.appendChild(message);
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  function showTypingAnimation() {
    removeTypingAnimation(); // prevent duplicates
    const typing = document.createElement('div');
    typing.classList.add('message', 'bot', 'typing');
    typing.id = 'typing';
    typing.innerText = 'EchoVice is thinking...';
    chatbox.appendChild(typing);
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  function removeTypingAnimation() {
    const typing = document.getElementById('typing');
    if (typing) typing.remove();
  }

  async function sendMessage() {
    const userText = statementInput.value.trim();
    const persona = personaSelect.value;
    if (!userText || isFetching) return;

    isFetching = true;

    submitBtn.disabled = true;
    appendMessage(userText, 'user');
    sessionHistory.push({ role: 'user', content: userText });
    statementInput.value = '';

    showTypingAnimation();

    try {
      const res = await fetch('/debate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          statement: userText,
          persona: persona,
          history: sessionHistory
        })
      });

      const data = await res.json();
      removeTypingAnimation();

      if (data.response) {
        appendMessage(data.response, 'bot');
        sessionHistory.push({ role: 'bot', content: data.response });
      } else {
        appendMessage('⚠️ Error: ' + (data.error || 'Unknown error occurred'), 'bot');
      }
    } catch (err) {
      removeTypingAnimation();
      appendMessage('⚠️ Connection Error: Unable to reach EchoVice.', 'bot');
      console.error('Fetch error:', err);
    } finally {
      submitBtn.disabled = false;
      isFetching = false;
    }
  }

  submitBtn.addEventListener('click', sendMessage);

  statementInput.addEventListener('keypress', function (e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  statementInput.addEventListener('input', function () {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
  });

  loadTheme();

  // Initial welcome message
  setTimeout(() => {
    appendMessage("👋 Welcome to EchoVice! I'm here to challenge your perspectives and engage in thoughtful debate. Share any opinion or statement, and I'll argue the opposing side with logic and wit. Let's explore different viewpoints together!", 'bot');
  }, 500);
</script>

</body>

</html>
